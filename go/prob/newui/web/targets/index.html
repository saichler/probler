<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Targets Management</title>
    <link rel="stylesheet" href="../edit_table/table.css">
    <link rel="stylesheet" href="targets.css">
</head>
<body>
    <div class="container">
        <section id="targets" class="content-section">
            <div class="filter-bar">
                <div class="filter-group">
                    <label for="inventory-type-filter">Inventory Type:</label>
                    <select id="inventory-type-filter" onchange="onInventoryTypeChange(this.value)">
                        <!-- Options populated by JS -->
                    </select>
                </div>
            </div>
            <div id="targets-table-container"></div>
        </section>
    </div>

    <!-- Target Modal (Add/Edit L8PTarget) -->
    <div id="target-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="target-modal-title">Add Target</h3>
                <button class="close-btn" onclick="closeTargetModal()">&times;</button>
            </div>
            <form id="target-form" onsubmit="saveTarget(event)">
                <input type="hidden" id="target-edit-mode" value="add">
                <div class="form-row">
                    <div class="form-group">
                        <label for="target-id">Target ID</label>
                        <input type="text" id="target-id" required>
                    </div>
                    <div class="form-group">
                        <label for="target-links-id">Links ID</label>
                        <input type="text" id="target-links-id">
                    </div>
                </div>
                <div class="form-group">
                    <label for="target-state">State</label>
                    <select id="target-state">
                        <option value="0">Down</option>
                        <option value="1">Up</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Hosts</label>
                    <div class="nested-table-container">
                        <div class="nested-table-header">
                            <span>Configured Hosts</span>
                            <button type="button" class="btn btn-small" onclick="showHostModal()">
                                + Add Host
                            </button>
                        </div>
                        <table class="nested-items-table">
                            <thead>
                                <tr>
                                    <th>Host ID</th>
                                    <th>Protocols</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="hosts-tbody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTargetModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Host Modal (Add/Edit L8PHost) -->
    <div id="host-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="host-modal-title">Add Host</h3>
                <button class="close-btn" onclick="closeHostModal()">&times;</button>
            </div>
            <form id="host-form" onsubmit="saveHost(event)">
                <input type="hidden" id="host-edit-index" value="-1">
                <div class="form-group">
                    <label for="host-id">Host ID</label>
                    <input type="text" id="host-id" placeholder="e.g., router1, switch-core" required>
                </div>
                <div class="form-group">
                    <label>Protocol Configurations</label>
                    <div class="nested-table-container">
                        <div class="nested-table-header">
                            <span>Protocols</span>
                            <button type="button" class="btn btn-small" onclick="showConfigModal()">
                                + Add Protocol
                            </button>
                        </div>
                        <table class="nested-items-table">
                            <thead>
                                <tr>
                                    <th>Protocol</th>
                                    <th>Address</th>
                                    <th>Port</th>
                                    <th>Credential ID</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="configs-tbody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeHostModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">Save Host</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Protocol Config Modal -->
    <div id="config-modal" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h3 id="config-modal-title">Add Protocol</h3>
                <button class="close-btn" onclick="closeConfigModal()">&times;</button>
            </div>
            <form id="config-form" onsubmit="saveConfig(event)">
                <input type="hidden" id="config-edit-index" value="-1">
                <div class="form-group">
                    <label for="config-protocol">Protocol</label>
                    <select id="config-protocol">
                        <option value="1">SSH</option>
                        <option value="2">SNMPV2</option>
                        <option value="3">SNMPV3</option>
                        <option value="4">RESTCONF</option>
                        <option value="5">NETCONF</option>
                        <option value="6">GRPC</option>
                        <option value="7">Kubectl</option>
                        <option value="8">GraphQL</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="config-addr">Address</label>
                        <input type="text" id="config-addr" placeholder="e.g., 192.168.1.1" required>
                    </div>
                    <div class="form-group">
                        <label for="config-port">Port</label>
                        <input type="number" id="config-port" value="22" min="1" max="65535">
                    </div>
                </div>
                <div class="form-group">
                    <label for="config-cred-id">Credential ID</label>
                    <select id="config-cred-id">
                        <option value="">-- Select Credential --</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeConfigModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">Save Protocol</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Confirm Delete</h3>
                <button class="close-btn" onclick="closeDeleteModal()">&times;</button>
            </div>
            <p id="delete-message">Are you sure you want to delete this target?</p>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">
                    Cancel
                </button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <script src="config.js"></script>
    <script src="../edit_table/table.js"></script>
    <script src="targets.js"></script>
    <script src="targets-hosts.js"></script>
</body>
</html>
