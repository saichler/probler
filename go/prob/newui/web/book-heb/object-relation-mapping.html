<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#fdfbf7">
    <meta name="description" content="מיפוי יחסי אובייקטים | פשטות רדיקלית לבני אדם מאת שרון אייכלר">
    <meta name="author" content="שרון אייכלר">
    <title>מיפוי יחסי אובייקטים | פשטות רדיקלית לבני אדם</title>
    <link rel="stylesheet" href="css/book.css">
</head>
<body>
    <button class="mobile-nav-toggle" aria-label="פתח/סגור תפריט">
        <span></span>
        <span></span>
        <span></span>
    </button>
    <div class="sidebar-overlay"></div>

    <div class="site-container">
        <nav class="sidebar" role="navigation" aria-label="תוכן עניינים">
            <header class="site-header">
                <h1 class="book-title">פשטות רדיקלית<br>לבני אדם</h1>
                <p class="book-subtitle">שכבה 8</p>
                <div class="author-info">
                    <p>שרון אייכלר</p>
                    <p><a href="mailto:saichler@gmail.com">saichler@gmail.com</a></p>
                </div>
                <div class="sponsor-button">
                    <iframe src="https://github.com/sponsors/saichler/button" title="Sponsor saichler" height="32" width="114" style="border: 0; border-radius: 6px;"></iframe>
                </div>
            </header>

            <h2 class="nav-title">תוכן עניינים</h2>
            <ul class="chapter-list">
                <li><a href="book.html">בית</a></li>
                <li><a href="about.html">אודות המחבר</a></li>
                <li><a href="introduction.html">מבוא</a></li>
                <li><a href="thoughts.html">מחשבות</a></li>
                <li><a href="ground-rules.html">כללי יסוד</a></li>
                <li><a href="architecture.html">ארכיטקטורה כמנגנון יישור</a></li>
                <li><a href="failure-modes.html">מצבי כשל</a></li>
                <li><a href="economics.html">כלכלה</a></li>
                <li><a href="security.html">אבטחה</a></li>
                <li><a href="networking.html">רשתות</a></li>
                <li><a href="serialization.html">סריאליזציה</a></li>
                <li><a href="model-agnostic-runtime.html">זמן ריצה אגנוסטי למודל</a></li>
                <li><a href="service-as-contract.html">שירות כחוזה</a></li>
                <li><a href="api-query-language.html">API ושפת שאילתות</a></li>
                <li><a href="object-relation-mapping.html" class="active">מיפוי יחסי אובייקטים</a></li>
                <li><a href="web-server.html">שרת אינטרנט</a></li>
                <li><a href="quality.html">איכות</a></li>
                <li><a href="practice.html">תרגול</a></li>
                <li><span class="coming-soon">פשטות רדיקלית ל-AI</span></li>
                <li><span class="coming-soon">מיגרציה</span></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="content-wrapper">
                <article>
                    <h1>מיפוי יחסי אובייקטים</h1>

                    <p>שמירת מודלים אובייקטיים במסדי נתונים יחסיים תמיד הייתה קשה. מיפוי יחסי אובייקטים (ORM) הוצג כפתרון.</p>

                    <p>הרעיון נשמע פשוט: סמן את המודל שלך עם רמזים יחסיים, ותן ל-ORM לתרגם אובייקטים לטבלאות ורשומות, ובחזרה.</p>

                    <p>על הנייר, זה נראה כמו התקדמות.<br>
                    בפועל, זה יוצר בעיות חדשות.</p>

                    <hr>

                    <h2>מצבי כשל מפורשים של ORM שזה מחליף</h2>

                    <p>ORM מסורתיים נוטים להיכשל בדרכים צפויות:</p>

                    <ul>
                        <li>פיצוצי שאילתות N+1 הנגרמים על ידי טעינה עצלה משתמעת</li>
                        <li>הידרציה בלתי מוגבלת של גרף אובייקטים</li>
                        <li>ביצועים בלתי צפויים עקב צירופים משתמעים</li>
                        <li>דליפת סכמה למודלים תחומיים דרך אנוטציות</li>
                        <li>צימוד לספק ודיאלקט</li>
                        <li>מיגרציות שבירות וסחיפת סכמה</li>
                        <li>תופעות לוואי של קסקדה ויתומים</li>
                        <li>אי-בהירות גבולות טרנזקציות</li>
                        <li>עיוות מודל מונע על ידי אי-התאמת עכבה</li>
                    </ul>

                    <p>שכבה 8 מבטלת את מצבי כשל אלה על ידי הסרת פרזיסטנס משתמע מבוסס מופעים והחלפתו באינטרוספקציה וממשקים מפורשים.</p>

                    <p>ראשית, שכבת הפרזיסטנס הופכת לצמודה היטב למסדי נתונים יחסיים, לעתים קרובות לספק או דיאלקט ספציפי.</p>

                    <p>שנית, המורכבות לא נעלמת. היא זזה.</p>

                    <p>במקום לתחזק סכמות מסדי נתונים, צוותים עכשיו מתחזקים מודלים עמוסי אנוטציות. ככל שמודלים גדלים וגדלים בעומק, נטל האנוטציות הופך משמעותי.</p>

                    <p>המודל מפסיק לייצג את התחום. הוא מתחיל לייצג את מסד הנתונים.</p>

                    <p>שכבה 8 נוקטת גישה שונה.</p>

                    <p>כדי להשיג זאת, שכבה 8 מפרקת את מושג ה-ORM המסורתי לשלוש שכבות נפרדות, המחוברות רק דרך ממשקים מפורשים וגבולות בעלות:</p>

                    <p><strong>Service</strong><br>
                    חושף פרזיסטנס כחוזה אגנוסטי לאחסון (באמצעות ממשק שירות שכבה 8 סטנדרטי), תוך שמירה על שירותים צורכים לא מודעים למכניקת האחסון.</p>

                    <p><strong>Convert</strong><br>
                    בבעלות מתאם הפרזיסטנס, Convert מקרין מופעי מודל ממשקי נתונים יחסיים ובחזרה באמצעות אינטרוספקציה, מבלי להטמיע דאגות מסד נתונים במודל.</p>

                    <p><strong>Persist</strong><br>
                    גם בבעלות מתאם הפרזיסטנס, Persist מטפל באחסון ואחזור עמיד של נתונים יחסיים, מבודד גם מסמנטיקה תחומית וגם מחיבור המודל.</p>

                    <p>על ידי הפרדת Service, Convert ו-Persist, שכבה 8 מבטלת צימוד הדוק, מונעת דליפת סכמה למודל ומאפשרת לכל שכבה להתפתח באופן עצמאי.</p>

                    <p>פרזיסטנס הופך לניתן להרכבה, להחלפה ומכוון.</p>

                    <h2>גבולות בעלות: שירותים מול פרזיסטנס</h2>

                    <p>שכבה 8 אוכפת הפרדה נוקשה בין בעלות תחומית לבעלות אחסון.</p>

                    <p>לשירות צורך אין מודעות לפרזיסטנס או אחסון. הוא לא יודע טבלאות, סכמות, אינדקסים, שאילתות, פורמטי סריאליזציה או דיאלקטים של מסדי נתונים.</p>

                    <p>שירות מחזיק:</p>

                    <ul>
                        <li>מחזור החיים התחומי של אובייקט ראשי</li>
                        <li>תיקוף ואינווריאנטים</li>
                        <li>בעלות מקביליות</li>
                        <li>התנהגות תחומית</li>
                    </ul>

                    <p>מתאם הפרזיסטנס מחזיק את כל ייצוג האחסון והעמידות, כולל:</p>

                    <ul>
                        <li>Convert: הקרנת מודל מינטרוספקטד לצורה יחסית ובנייתו מחדש בקריאה</li>
                        <li>Persist: ביצוע פעולות קריאה וכתיבה עמידות כנגד ה-backend שנבחר</li>
                    </ul>

                    <p>הפרדה זו שומרת על שירותים ניידים תוך מתן אפשרות לתוספי פרזיסטנס להתפתח, להיות מיטובים או להחליף backends מבלי להדליף דאגות סכמה ללוגיקה תחומית.</p>

                    <hr>

                    <h2>המודל היחסי של שכבה 8</h2>

                    <p>מימוש פרקים 9 ו-11 חושף תוצאה חשובה: לשכבה 8 כבר יש מספיק מידע כדי לתרגם כל מופע מודל לנתונים יחסיים מבלי לדרוש אנוטציות או רמזים נוספים.</p>

                    <p>לא נדרשים מטא-נתונים ספציפיים ל-ORM.</p>

                    <p>הכלל פשוט:</p>

                    <ul>
                        <li>כל struct או מחלקה במודל ממופה לטבלה לוגית.</li>
                        <li>כל מופע מודל ממופה לשורה לוגית אחת או יותר.</li>
                        <li>כל שורה לוגית מזוהה באופן ייחודי על ידי PropertyId.</li>
                    </ul>

                    <p>מיפוי זה נגזר כולו ממבנה המודל המינטרוספקטד. כדי לפורמל זאת, שכבה 8 מציגה את מודל L8RelationData.</p>

                    <p>L8RelationData מייצג מצב יחסי כאבסטרקציה לוגית, בלתי תלויה בכל מימוש מסד נתונים פיזי.</p>

                    <p><em>הוא מורכב מ</em>:</p>

                    <ul>
                        <li>מיפוי משם struct לטבלה לוגית.</li>
                        <li>כל טבלה לוגית מכילה מיפוי מ-PropertyId לשורה לוגית.</li>
                        <li>כל שורה לוגית מכילה מיפוי משם שדה לערך שדה.</li>
                    </ul>

                    <p><em>במילים אחרות</em>:</p>

                    <ul>
                        <li>טבלאות הן לוגיות, לא פיזיות.</li>
                        <li>שורות מזוהות על ידי נתיבי מודל, לא מפתחות ראשיים.</li>
                        <li>שדות שומרים על המשמעות הסמנטית המקורית שלהם.</li>
                    </ul>

                    <p>ייצוג יחסי זה נגזר, לא מתוכנן. הוא צומח באופן טבעי מהמודל ומבנהו.</p>

                    <p>על ידי התייחסות לנתונים יחסיים כפרויקציה של המודל, שכבה 8 נמנעת מאנוטציות סכמה, כללי מיפוי והנחות ספציפיות למסד נתונים.</p>

                    <p>המודל נשאר טהור. התצוגה היחסית נוצרת. פרזיסטנס מסתגל למודל.</p>

                    <hr>

                    <h2>Service</h2>

                    <p>שירות ה-ORM של שכבה 8 מכמס את האינטראקציה בין רכיבי Convert ו-Persist ומציג אותם עם אותו מראה ותחושה כמו רכיב המטמון המבוזר.</p>

                    <p>מנקודת מבטו של שירות צורך, פרזיסטנס בלתי נראה. השירות נשאר אגנוסטי לחלוטין ל:</p>

                    <ul>
                        <li>איך נתונים מומרים,</li>
                        <li>איך הם מאוחסנים,</li>
                        <li>ואיך שאילתות מבוצעות.</li>
                    </ul>

                    <p>אינטראקציה עם שירות ה-ORM משתמשת בממשק שירות שכבה 8 סטנדרטי: POST, PUT, PATCH, DELETE ו-GET, כמתואר בפרק 11.</p>

                    <h3>נתיב כתיבה</h3>

                    <p>עבור פעולות כתיבה, שכבת Service:</p>

                    <ul>
                        <li>ממירה מופעי מודל לנתונים יחסיים באמצעות ממשק Convert,</li>
                        <li>מעבירה את הנתונים היחסיים המתקבלים לשכבת Persist לאחסון.</li>
                    </ul>

                    <h3>נתיב קריאה</h3>

                    <p>עבור פעולות שאילתה, שכבת Service:</p>

                    <ul>
                        <li>מעבירה את L8Query ישירות לשכבת Persist,</li>
                        <li>מקבלת נתונים יחסיים כתוצאה,</li>
                        <li>מעבירה את הנתונים דרך ממשק Convert,</li>
                        <li>ומחזירה מופעי מודל לקורא.</li>
                    </ul>

                    <p>בשום שלב השירות הצורך אינו מתקשר עם מבנים יחסיים, סכמות או פרטים ספציפיים למסד נתונים.</p>

                    <p>שכבת Service פועלת כחזית. היא אוכפת את חוזה השירות, מתאמת המרה ופרזיסטנס ומשמרת את האשליה של עבודה עם מערכת בזיכרון, native למודל.</p>

                    <p><strong>פרזיסטנס הופך לשירות, לא לדאגה.</strong></p>

                    <hr>

                    <h2>Convert</h2>

                    <p>שכבת Convert מבצעת פעולה מכנית ודטרמיניסטית. אין מורכבות נסתרת ואין לוגיקה תחומית.</p>

                    <p><em>היא לוקחת</em>:</p>

                    <ul>
                        <li>מופעי מודל וממירה אותם לנתונים יחסיים, או</li>
                        <li>נתונים יחסיים וממירה אותם בחזרה למופעי מודל.</li>
                    </ul>

                    <p>כל ההמרות מונעות לחלוטין על ידי תכנית ה-Introspector ומנגנון ה-Property שתוארו בפרק 9. לא מוטמעים כללים ספציפיים למודל. לא נעשות הנחות ספציפיות למסד נתונים.</p>

                    <p>המרה היא מבנית, לא סמנטית. היא משמרת צורה וערכים, לא משמעות עסקית.</p>

                    <p>על ידי שמירה על המרה כמכנית גרידא, שכבה 8 מבטיחה שלוגיקת פרזיסטנס נשארת צפויה, ניתנת לבדיקה וניתנת להחלפה.</p>

                    <p>שכבת Convert עושה דבר אחד: <strong>מתרגמת ייצוגים. לא יותר.</strong></p>

                    <hr>

                    <h2>Persist</h2>

                    <p>שמירת נתונים יחסיים היא מכוונת פשוטה.</p>

                    <p>נתונים יחסיים יכולים להיות מאוחסנים ב:</p>

                    <ul>
                        <li>טבלאות מסד נתונים יחסי,</li>
                        <li>קבצים,</li>
                        <li>NoSql,</li>
                        <li>או כל מנגנון אחסון עמיד אחר.</li>
                    </ul>

                    <p>שכבה 8 נמנעת מאנוטציות מורכבות וכללי מיפוי. במקום זאת, היא מסתמכת על שני עמודות אוניברסליות המתווספות לכל רשומה יחסית:</p>

                    <ul>
                        <li>ParentPropertyId</li>
                        <li>PropertyId</li>
                    </ul>

                    <p>עם שני מזהים אלה, ניתן לבנות מחדש את גרף האובייקטים המלא באופן דטרמיניסטי. לא נדרשים רמזי סכמה נוספים או אנוטציות מודל. ממשק Persist אוכף <strong>L8Query</strong> כקלט לפעולות קריאה. זה מפשט את כל פרטי המימוש.</p>

                    <p>כל תוסף פרזיסטנס אחראי ל:</p>

                    <ul>
                        <li>תרגום L8Query לשאילתה ממוטבת למערכת האחסון הבסיסית שלו,</li>
                        <li>ביצוע שאילתה זו ביעילות,</li>
                        <li>והחזרת נתונים יחסיים בפורמט סטנדרטי.</li>
                    </ul>

                    <p>שכבת Persist לא יודעת דבר על:</p>

                    <ul>
                        <li>סמנטיקת מודל,</li>
                        <li>התנהגות שירות,</li>
                        <li>או לוגיקה עסקית.</li>
                    </ul>

                    <p><strong>היא מתמקדת אך ורק באחסון ואחזור עמיד.</strong></p>

                    <p>על ידי בידוד פרזיסטנס מאחורי ממשק נוקשה, שכבה 8 מאפשרת להחליף, למטב או להחליף מנועי אחסון מבלי להשפיע על שירותים, מודלים או API.</p>

                    <p><strong>פרזיסטנס הופך לניתן לחיבור. החוזה נשאר יציב. המערכת מתפתחת בבטחה.</strong></p>

                    <hr>

                    <h2>אבולוציית סכמה ללא תיאום שירותים</h2>

                    <p>שכבה 8 תומכת באבולוציית סכמה ללא צורך בתיאום בין שירותים, פריסות מסונכרנות או מודעות לסכמה בתוך שירותים.</p>

                    <p>אבולוציית מודל בדרך כלל נופלת לשתי קטגוריות:</p>

                    <p>שינויים טריוויאליים</p>

                    <ul>
                        <li>הוספה או הסרה של תכונות</li>
                    </ul>

                    <p>שינויים מבניים</p>

                    <ul>
                        <li>שינוי שם או צורה של שדות או תת-מודלים</li>
                        <li>פיצול או מיזוג מבנים</li>
                    </ul>

                    <hr>

                    <h3>אבולוציה טריוויאלית</h3>

                    <p>עבור שינויי תכונות תוספתיים או חיסוריים, מתאם הפרזיסטנס יכול לזהות סחיפת צורת מודל דרך אינטרוספקציה באתחול ולהחיל התאמות בטוחות ואוטומטיות לייצוג האחסון שלו.</p>

                    <p>שירותים קיימים ממשיכים לפעול ללא שינוי, והמערכת נמנעת מדריסה שקטה של שדות שנוספו לאחרונה.</p>

                    <h3>אבולוציה מבנית</h3>

                    <p>חלק מהשינויים לא ניתנים להסקה בטוחה ודורשים כוונה מפורשת כדי להימנע מאובדן נתונים או השחתה סמנטית.</p>

                    <p>כאשר סחיפה מבנית מזוהה:</p>

                    <ul>
                        <li>מתאם הפרזיסטנס קובע שהשינוי אינו טריוויאלי</li>
                        <li>שירות התחום מספק כוונת מיגרציה דרך ממשק שמספק הפרזיסטנס</li>
                        <li>מתאם הפרזיסטנס מחיל את הכוונה באופן עקבי ועמיד</li>
                    </ul>

                    <p>אם לא סופקה כוונה, המערכת עשויה להמשיך לפעול באופן שמרני, תוך מתן עדיפות לבטיחות נתונים על פני טרנספורמציה אגרסיבית.</p>

                    <hr>

                    <h2>מילה על מימוש תוספים</h2>

                    <p>יצירת טבלאות, אינדקסים ושמירת נתונים יחסיים היא בדרך כלל פשוטה.</p>

                    <p>תרגום L8Query לשאילתה ממוטבת וספציפית לאחסון - לא.</p>

                    <p>לדוגמה, המרת L8Query ל-SQL PostgreSQL יעיל דורשת תכנון שאילתות, מודעות לאינדקסים והחלטות אסטרטגיית ביצוע. דאגות אלה הן מטבען ספציפיות לאחסון.</p>

                    <p>שכבה 8 מספקת רכיבים, בסיוע AI, לטיפול בתרגום זה. עם זאת, חלק קטן מלוגיקה זו הוא בהכרח ספציפי למסד נתונים.</p>

                    <p>מסיבה זו, רכיבים אלה אינם בכוונה חלק מאבסטרקציית ה-ORM המרכזית.</p>

                    <p><strong>במקום זאת, הם מסופקים כמימושי התייחסות.</strong></p>

                    <p>ניתן לעשות להם fork, להתאים ולהרחיב אותם כדי ליצור תוספי פרזיסטנס למנועי אחסון אחרים במאמץ מינימלי.</p>

                    <p>הגבול מכוון:</p>

                    <ul>
                        <li>שכבה 8 מגדירה את החוזה.</li>
                        <li>תוספים מטפלים באופטימיזציה.</li>
                    </ul>

                    <p><strong>אינטליגנציה ספציפית לאחסון נשארת מבודדת.</strong></p>

                    <p>זה שומר על ה-ORM נייד, תוך מתן אפשרות למימושים בעלי ביצועים גבוהים ומודעי אחסון.</p>

                    <hr>

                    <h2>חיזוק כלל מס' 5: ממשק, לא מופע</h2>

                    <p>פרק זה מסתמך על כלל מס' 5: ממשק, לא מופע.</p>

                    <p>שירותים בשכבה 8 לעולם אינם מתקשרים עם פרזיסטנס דרך אובייקטים חיים, sessions, repositories או ישויות מגובות מסד נתונים. במקום זאת, שירותים מבטאים כוונה דרך ממשקים, ותוספי פרזיסטנס מבצעים את הכוונה כנגד מופעי אחסון קונקרטיים.</p>

                    <p>הפרדה זו היא מה שהופך את החלפת ה-ORM לצפויה: היא מונעת תופעות לוואי נסתרות, שומרת על משך חיי אחסון מחוץ ללוגיקה תחומית ומאפשרת לייצוג ומימוש פרזיסטנס להתפתח באופן עצמאי.</p>

                    <nav class="chapter-nav">
                        <a href="api-query-language.html" class="prev">API ושפת שאילתות</a>
                        <a href="web-server.html" class="next">שרת אינטרנט</a>
                    </nav>
                </article>
            </div>
        </main>
    </div>

    <script src="js/book.js"></script>
</body>
</html>
